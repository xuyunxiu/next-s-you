<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Weverse Clone</title>
    <style>
        /* --- CSS æ¨£å¼å€ --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            background-color: #000; color: #fff; margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            overflow-x: hidden;
        }
        
        .view { display: none; min-height: 100vh; width: 100vw; position: relative; }
        .active-view { display: block; }

        /* æ¨™é¡Œå€ */
        .step-header { padding: 60px 25px 20px; }
        .step-header h1 { font-size: 26px; font-weight: bold; margin: 0; line-height: 1.3; }
        .step-header p { color: #888; font-size: 14px; margin-top: 10px; }

        /* 1. æ–°äººå¤šé¸å¡ç‰‡ç‰† */
        .card-grid { 
            display: grid; grid-template-columns: 1fr 1fr; gap: 12px; 
            padding: 0 15px 150px; /* ç•™ç©ºé–“çµ¦åº•éƒ¨æŒ‰éˆ• */
        }
        .artist-card { 
            aspect-ratio: 1 / 1.25; border-radius: 25px; background-size: cover; 
            background-position: center; position: relative; border: 2.5px solid transparent; 
            transition: transform 0.2s, border-color 0.2s; cursor: pointer;
        }
        .artist-card.selected { border-color: #fff; transform: scale(0.98); }
        .check-badge { 
            position: absolute; top: 12px; right: 12px; background: #fff; color: #000; 
            width: 22px; height: 22px; border-radius: 50%; text-align: center; 
            line-height: 22px; font-weight: bold; font-size: 12px; display: none;
        }
        .selected .check-badge { display: block; }
        .artist-name { 
            position: absolute; bottom: 15px; left: 15px; font-weight: bold; 
            font-size: 14px; text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }

        /* 2. è¨­å®šå€‹äººè³‡è¨Šé é¢ */
        .form-body { padding: 40px 25px; text-align: center; }
        .user-input { 
            width: 100%; padding: 18px; border-radius: 15px; border: 1px solid #333; 
            background: #111; color: #fff; font-size: 18px; text-align: center;
            outline: none; transition: border-color 0.3s;
        }
        .user-input:focus { border-color: #00f0ff; }
        .input-hint { color: #555; font-size: 12px; margin-top: 15px; }

        /* 3. è€å±è‚¡é¦–é  UI */
        .home-header { 
            padding: 15px; font-size: 20px; font-weight: bold; text-align: center; 
            border-bottom: 0.5px solid #222; position: sticky; top: 0; background: #000; z-index: 10;
        }
        .avatar-bar { 
            display: flex; overflow-x: auto; padding: 15px; gap: 12px; 
            border-bottom: 0.5px solid #111; scrollbar-width: none;
        }
        .avatar-bar::-webkit-scrollbar { display: none; }
        .circle-wrap { text-align: center; flex-shrink: 0; width: 65px; cursor: pointer; }
        .circle { 
            width: 60px; height: 60px; border-radius: 50%; background: #222; 
            border: 1px solid #333; overflow: hidden; display: flex; 
            align-items: center; justify-content: center; margin-bottom: 5px;
        }
        .circle img { width: 100%; height: 100%; object-fit: cover; }
        .circle.plus { font-size: 24px; color: #fff; border: 1px dashed #555; background: #0a0a0a; }
        .circle-name { font-size: 10px; color: #999; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* åº•éƒ¨å›ºå®šæŒ‰éˆ•å€ */
        .sticky-footer { 
            position: fixed; bottom: 0; width: 100%; padding: 20px; 
            background: linear-gradient(transparent, #000 40%); z-index: 100;
        }
        .btn-main { 
            width: 100%; padding: 18px; border-radius: 40px; border: none; 
            background: #333; color: #777; font-weight: bold; font-size: 16px; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-main.active { background: #fff; color: #000; cursor: pointer; }

        /* åº•éƒ¨æ¨™ç±¤åˆ— (è€å±è‚¡é¦–é ç”¨) */
        .tab-bar { 
            position: fixed; bottom: 0; width: 100%; height: 70px; background: #000; 
            display: flex; justify-content: space-around; align-items: center; 
            border-top: 0.5px solid #222; font-size: 22px; 
        }

        /* é‡ç½®æŒ‰éˆ• */
        .btn-reset { 
            background: none; border: 1px solid #333; color: #444; 
            padding: 8px 15px; border-radius: 10px; margin-top: 50px; font-size: 12px;
        }
    </style>
</head>
<body>

<div id="app">
    <section id="view-artist-select" class="view">
        <header class="step-header">
            <h1>æ­¡è¿ï¼<br>é¸æ“‡æ‚¨æ„Ÿèˆˆè¶£çš„è—äºº</h1>
            <p>æ‚¨å¯ä»¥å¤šé¸å¹¾å€‹ç¤¾ç¾¤åŠ å…¥ âœ¨</p>
        </header>
        <div class="card-grid" id="cardGrid">
            </div>
        <div class="sticky-footer">
            <button id="toStep2Btn" class="btn-main" onclick="goToProfileSetup()">ä¸‹ä¸€æ­¥</button>
        </div>
    </section>

    <section id="view-profile-setup" class="view">
        <header class="step-header">
            <h1>è¨­å®šæ‚¨çš„ä½¿ç”¨è€…åç¨±</h1>
            <p>é€™æ˜¯æ‚¨åœ¨ App ä¸­çš„å€‹äºº ID</p>
        </header>
        <div class="form-body">
            <input type="text" id="userNameInput" class="user-input" placeholder="è«‹è¼¸å…¥åç¨±" maxlength="15">
            <p class="input-hint">ä¹‹å¾Œéš¨æ™‚å¯ä»¥ä¿®æ”¹å€‹äººè³‡æ–™</p>
        </div>
        <div class="sticky-footer">
            <button class="btn-main active" onclick="completeRegistration()">é€²å…¥ Weverse</button>
        </div>
    </section>

    <section id="view-home" class="view">
        <nav class="home-header">weverse</nav>
        <div class="avatar-bar" id="avatarBar">
            </div>
        <main style="padding: 40px 20px; text-align: center;">
            <h2 id="welcomeMsg" style="margin-bottom: 10px;"></h2>
            <div style="color: #444; margin-top: 50px;">ç›®å‰å°šç„¡æ–°è²¼æ–‡</div>
            <button class="btn-reset" onclick="resetApp()">é‡ç½®ä¸¦å›æ­¸æ–°äººèº«åˆ†</button>
        </main>
        <nav class="tab-bar">
            <span>ğŸ </span><span>ğŸ’¬</span><span>ğŸ””</span><span>ğŸ‘¤</span>
        </nav>
    </section>
</div>

<script>
    /* --- JS é‚è¼¯å€ --- */

    // 1. è™›æ“¬è³‡æ–™åº« (Artist Database)
    const ALL_ARTISTS = [
        { id: 1, name: "BLACKPINK", img: "https://placehold.co/100x100/ff69b4/fff?text=BP", card: "https://placehold.co/400x500/ff69b4/fff?text=BLACKPINK" },
        { id: 2, name: "DREAMCATCHER", img: "https://placehold.co/100x100/4b0082/fff?text=DC", card: "https://placehold.co/400x500/4b0082/fff?text=DREAMCATCHER" },
        { id: 3, name: "BABYMONSTER", img: "https://placehold.co/100x100/ff0000/fff?text=BM", card: "https://placehold.co/400x500/ff0000/fff?text=BABYMONSTER" },
        { id: 4, name: "NCT DREAM", img: "https://placehold.co/100x100/adff2f/000?text=NCT", card: "https://placehold.co/400x500/adff2f/000?text=NCT+DREAM" },
        { id: 5, name: "NewJeans", img: "https://placehold.co/100x100/87ceeb/fff?text=NJ", card: "https://placehold.co/400x500/87ceeb/fff?text=NewJeans" }
    ];

    // 2. æ‡‰ç”¨ç¨‹å¼ç‹€æ…‹ (State)
    let state = {
        tempSelectedIds: [],
        userName: localStorage.getItem("wv_user_name") || "",
        myGroups: JSON.parse(localStorage.getItem("wv_my_groups") || "[]")
    };

    // 3. è¦–åœ–æ§åˆ¶å™¨
    function switchView(viewId) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active-view'));
        document.getElementById(viewId).classList.add('active-view');
    }

    // 4. æ–°äººé¸å–é‚è¼¯
    function renderArtistCards() {
        const grid = document.getElementById('cardGrid');
        grid.innerHTML = ALL_ARTISTS.map(a => `
            <div class="artist-card ${state.tempSelectedIds.includes(a.id) ? 'selected' : ''}" 
                 onclick="handleCardClick(${a.id})" 
                 style="background-image: url('${a.card}')">
                <div class="check-badge">âœ“</div>
                <div class="artist-name">${a.name}</div>
            </div>
        `).join('');
    }

    function handleCardClick(id) {
        const index = state.tempSelectedIds.indexOf(id);
        if (index === -1) {
            state.tempSelectedIds.push(id);
        } else {
            state.tempSelectedIds.splice(index, 1);
        }
        updateNextButton();
        renderArtistCards();
    }

    function updateNextButton() {
        const btn = document.getElementById('toStep2Btn');
        if (state.tempSelectedIds.length > 0) {
            btn.classList.add('active');
            btn.innerText = `åŠ å…¥ ${state.tempSelectedIds.length} å€‹ç¤¾ç¾¤ï¼Œä¸‹ä¸€æ­¥`;
        } else {
            btn.classList.remove('active');
            btn.innerText = "ä¸‹ä¸€æ­¥";
        }
    }

    function goToProfileSetup() {
        if (state.tempSelectedIds.length > 0) {
            switchView('view-profile-setup');
        }
    }

    // 5. è¨»å†Šå®Œæˆé‚è¼¯
    function completeRegistration() {
        const inputName = document.getElementById('userNameInput').value.trim();
        if (!inputName) return alert("è«‹è¼¸å…¥æ‚¨çš„åç¨±å–”ï¼");

        // æ›´æ–°ç‹€æ…‹ä¸¦å­˜å…¥æŒä¹…è¨˜æ†¶
        state.userName = inputName;
        state.myGroups = ALL_ARTISTS.filter(a => state.tempSelectedIds.includes(a.id));

        localStorage.setItem("wv_user_name", state.userName);
        localStorage.setItem("wv_my_groups", JSON.stringify(state.myGroups));

        initApp(); // è·³è½‰é¦–é 
    }

    // 6. è€å±è‚¡é¦–é é‚è¼¯
    function renderHomePage() {
        document.getElementById('welcomeMsg').innerText = `æ­¡è¿å›ä¾†ï¼Œ${state.userName}`;
        const bar = document.getElementById('avatarBar');
        
        // åŠ ä¸Šã€Œ+ã€æŒ‰éˆ•
        const plusBtn = `
            <div class="circle-wrap" onclick="alert('é€²å…¥æ–°å¢åˆ—è¡¨...')">
                <div class="circle plus">+</div>
                <div class="circle-name">æ–°å¢</div>
            </div>`;

        const groupItems = state.myGroups.map(g => `
            <div class="circle-wrap">
                <div class="circle"><img src="${g.img}"></div>
                <div class="circle-name">${g.name}</div>
            </div>
        `).join('');

        bar.innerHTML = plusBtn + groupItems;
    }

    function resetApp() {
        if(confirm("ç¢ºå®šè¦åˆªé™¤æ‰€æœ‰è³‡æ–™é‡æ–°é–‹å§‹å—ï¼Ÿ")) {
            localStorage.clear();
            location.reload();
        }
    }

    // 7. åˆå§‹åŒ–å•Ÿå‹•å™¨
    function initApp() {
        if (state.userName) {
            // å·²æœ‰è³‡æ–™ -> ç›´æ¥å»é¦–é 
            switchView('view-home');
            renderHomePage();
        } else {
            // æ–°äºº -> å»é¸å¡ç‰‡ç‰†
            switchView('view-artist-select');
            renderArtistCards();
        }
    }

    window.onload = initApp;
</script>

</body>
</html>
